<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>The Ray White App</title>
    <style>
      body {
        padding: 20px;
      }
      #root {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <p>Find notable events from a particular year:</p>
    <input type="text" placeholder="Enter a year" />
    <button type="submit">Search</button>
    <section id="results"></section>

    <script src="https://unpkg.com/wtf_wikipedia">
      // Read the documentation here:
      // https://github.com/spencermountain/wtf_wikipedia
    </script>

    <script>
      const input = document.querySelector('input[type=text]');
      const submitBtn = document.querySelector('button[type=submit]');
      const resultsSection = document.getElementById('results');

      function displayResults(res) {
        resultsSection.innerHTML = res;
      }

      wtf.fetch('1904').then(doc => {
        const collections = [];

        // Categorize Events
        doc.sections().forEach((section, i) => {
          if (section.depth === 0) {
            // Create a new event category (events, births, deaths, etc.)
            // that will contain events.
            collections.push({ [section._title]: [] });
          } else {
            // Select the latest event object and add the current event to it.
            const lastInArray = collections[collections.length - 1];
            const sectionEventsArr = lastInArray[Object.keys(lastInArray)[0]];

            section.lists().forEach(items => {
              items.data.forEach(item => {
                const line = item.text();
                // Remove cases where a date is on a line by itself.
                if (line.length > 15) return sectionEventsArr.push(line);
              });
            });
          }
        });

        // Remove empty categories
        const filteredCollections = collections.filter(collection => {
          return Object.values(collection)[0].length > 0;
        });

        // Put it all together in a single array
        let allEvents = [];
        const collectAllEvents = filteredCollections.forEach(list => {
          const eventType = Object.keys(list)[0];
          const events = Object.values(list)[0];
          allEvents.push(...events.map(event => `${eventType}: ${event}`));
        });

        console.log(allEvents);

        const generatedHTML = filteredCollections
          .map(list => {
            const eventType = Object.keys(list)[0];
            const events = Object.values(list)[0];

            const eventSection = `
              <h2>${eventType}</h2>
              <ul>
                ${events.map(li => `<li><strong>${eventType}:</strong> ${li}</li>`).join('')}
              </ul>
            `;

            return eventSection;
          })
          .join('');

        displayResults(generatedHTML);

        // const listing = doc
        //   .lists()
        //   .map(list => list.html())
        //   .join('------');

        // displayResults(listing);
      });
    </script>
  </body>
</html>
