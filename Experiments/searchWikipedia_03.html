<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>The Ray White App</title>
    <style>
      body {
        padding: 20px;
      }
      #root {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <p>Find notable events from a particular year:</p>
    <input type="text" placeholder="Enter a year" />
    <button type="submit">Search</button>
    <section id="results"></section>

    <script src="https://unpkg.com/wtf_wikipedia">
      // Read the documentation here:
      // https://github.com/spencermountain/wtf_wikipedia
    </script>

    <script>
      const input = document.querySelector('input[type=text]');
      const submitBtn = document.querySelector('button[type=submit]');
      const resultsSection = document.getElementById('results');

      function displayResults(res) {
        resultsSection.innerHTML = res;
      }

      wtf.fetch('1904').then(doc => {
        const collections = [];

        // Categorize Events
        doc.sections().forEach((section, i) => {
          if (section.depth === 0) {
            // Create a new event category (events, births, deaths, etc.)
            // that will contain events.
            collections.push({ [section._title]: [] });
          } else {
            // Select the latest event object and add the current event to it.
            const lastInArray = collections[collections.length - 1];
            const sectionEventsArr = lastInArray[Object.keys(lastInArray)[0]];
            sectionEventsArr.push(section.html());
          }
        });

        const filteredCollections = collections.filter(collection => {
          return Object.values(collection)[0].length > 0;
          // if (Object.values(collection)[0].length > 0) {
          //   console.log(Object.keys(collection));
          //   console.log(Object.values(collection)[0]);
          // }
        });

        console.log(filteredCollections);

        const generatedHTML = filteredCollections.map(list => {
          const eventSection = `
            <h2>${Object.keys(list)[0]}</h2>
            <ul>
              ${Object.values(list).map(li => `<li>${li}</li>`)}  
            </ul>
          `;
          console.log(eventSection);
          return eventSection;
        });

        displayResults(generatedHTML);

        // const listing = doc
        //   .lists()
        //   .map(list => list.html())
        //   .join('------');

        // displayResults(listing);
      });
    </script>
  </body>
</html>
